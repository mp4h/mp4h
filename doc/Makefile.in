##
##  Makefile -- mp4h Documentation
##

@SET_MAKE@
SHELL = /bin/sh

top_srcdir      = @top_srcdir@
VPATH           = @srcdir@
PROGDIR         = $(top_srcdir)/src
PROGRAM         = $(PROGDIR)/mp4h
FLAGS           = -X 0
DEPS            = list-tags
TIDY            = @TIDY@

RM              = rm -f

.SUFFIXES:
.SUFFIXES: .info .ps .dvi .texi .1 .pod
.texi.info:
	makeinfo $<
.texi.dvi:
	texi2dvi $<
.dvi.ps:
	dvips -o $@ $<
.pod.1:
	pod2man --section=1 \
            --center="HTML Tools" \
            --release="HTML Tools" \
        $< > $@

# ------------------------------------------------
#   THE DEFAULT TARGETS
# ------------------------------------------------

all: $(PROGRAM) mp4h.1 mp4h.html

install:
	@:

# ------------------------------------------------
#   DOCUMENTATION
# ------------------------------------------------

mp4h.html: mp4h.mp4h html.out $(PROGRAM) $(DEPS)
	$(PROGRAM) $(FLAGS) -D format=html mp4h.mp4h > $@
	-$(TIDY) $(TIDYOPT) -m $@

mp4h.pod: mp4h.mp4h pod.out $(PROGRAM) $(DEPS)
	$(PROGRAM) $(FLAGS) -D format=pod mp4h.mp4h \
        | sed -e 's/_LT_/</g' -e 's/_GT_/>/g' > $@

mp4h.texi: mp4h.mp4h texinfo.out $(PROGRAM) $(DEPS)
	#   Generate table of contents for Info navigation
	$(PROGRAM) $(FLAGS) -D format=texinfo -D info:gentoc=1 mp4h.mp4h |\
   grep '@remove@' | sed -e 's/@remove@//' -e 's/=LT=/</g' > mp4h.chp
	$(PROGRAM) $(FLAGS) -D format=texinfo mp4h.mp4h > $@

# ------------------------------------------------
#   PROGRAM
# ------------------------------------------------

$(PROGRAM):
	cd $(PROGDIR) && $(MAKE)

# ------------------------------------------------
#   CLEANUP
# ------------------------------------------------

clean:
	$(RM) *.pod *.1
	$(RM) *.html
	$(RM) *.info *.texi *.chp *.cp *.fn *.vr *.tp *.ky *.pg
	$(RM) *.aux *.log *.toc *.dvi *.ps

distclean: clean
	$(RM) Makefile

##EOF##
