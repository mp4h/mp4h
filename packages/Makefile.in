##
##  Makefile -- packages
##
@SET_MAKE@

# ------------------------------------------------
#   DEFINITIONS
# ------------------------------------------------

SHELL           = /bin/sh

top_srcdir      = @top_srcdir@
srcdir          = @srcdir@
prefix          = @prefix@
VPATH           = @srcdir@

RM              = rm -f

SHTOOL          = $(top_srcdir)/shtool
INSTALL_DATA    = $(SHTOOL) install -c -m 644
#   libtool does not like this definition
#INSTALL         = $(SHTOOL) install -c -m 644
INSTALL         = @INSTALL@
MKDIR           = $(SHTOOL) mkdir -f -p -m 755

prefix          = @prefix@

SDP     = packages/
SUBDIRS = \
   WML

# ------------------------------------------------
#   THE DEFAULT TARGET
# ------------------------------------------------

all: all-recursive

# ------------------------------------------------
#   THE INSTALL TARGET
# ------------------------------------------------

install: install-recursive

install-dirs:
	@set -e; $(INITVARS); \
	if [ ! -d "$(INSTPREFIX)$$mandir/man$(man3ext)" ]; then \
	        echo "$(MKDIR) $(INSTPREFIX)$$mandir/man$(man3ext)"; \
	        $(MKDIR) $(INSTPREFIX)$$mandir/man$(man3ext); \
	else :; \
	fi


# ------------------------------------------------
#   CLEANUP
# ------------------------------------------------

clean: clean-recursive

distclean: clean distclean-recursive
	-$(RM) Makefile

# ------------------------------------------------
#   RECURSIVE CALLS
# ------------------------------------------------

RECURS_TARGET = \
   echo "===> $(SDP)$$dir ($$target)"; \
   (cd $$dir && $(MAKE) SDP="$(SDP)$$dir/" prefix=$(prefix) $$target) \
   || case "$$amf" in *=*) exit 1;; *k*) fail=yes;; *) exit 1;; esac; \
   echo "<=== $(SDP)$$dir"

RECURS_TARGET_NOBREAK = \
   echo "===> $(SDP)$$dir ($$target)"; \
   (cd $$dir && $(MAKE) SDP="$(SDP)$$dir/" prefix=$(prefix) $$target); \
   echo "<=== $(SDP)$$dir"

#   Some GNU components (especially libltdl) require mkinstalldirs
#   to do nothing with it, so it is discarded
all-recursive install-recursive:
	-@set -e; \
	set dummy $(MAKEFLAGS); amf=$$2; \
	target=`echo $@ | sed s/-recursive//`; \
	for dir in $(SUBDIRS); do \
	    $(RECURS_TARGET); \
	done && test -z "$$fail"

clean-recursive distclean-recursive:
	@target=`echo $@ | sed s/-recursive//`; \
	for dir in $(SUBDIRS); do \
	    if [ -f $$dir/Makefile ]; then \
	        $(RECURS_TARGET_NOBREAK); \
	    else :; \
	    fi; \
	done

##EOF##
